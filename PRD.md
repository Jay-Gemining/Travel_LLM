# 产品需求文档 (PRD): 行程AIGC (Travel_LLM)

**版本**: 1.1
**日期**: 2025年7月1日
**负责人**: Gemini

---

## 0. 修订历史
- **v1.1 (2025/07/01)**: 增强输入（必游景点、旅行风格），提升输出质量（地理坐标、交通时间），并增加活动替换功能。
- **v1.0 (2025/06/30)**: 初始版本，定义核心生成流程。

---

## 1. 产品简介与目标

### 1.1. 产品简介
行程AIGC (Travel_LLM) 是一个基于大型语言模型（LLM）的智能旅行规划应用。它允许用户通过输入目的地城市、旅行天数和个人兴趣，快速生成一份结构清晰、内容丰富的个性化旅行日程。

### 1.2. 产品目标
- **核心问题**: 传统旅行规划耗时耗力，信息搜集繁琐，且难以快速个性化。
- **产品价值**: 旨在通过AI技术极大简化行程规划流程，让用户在几秒钟内获得一份高质量、个性化的旅行计划，从而提升旅行规划的效率和乐趣。
- **中期目标**: 在V1.0基础上，提供更强的个性化能力和更具实用性的行程输出，并引入初步的用户交互功能。

---

## 2. 目标用户

- **主要用户**: 计划进行1-7天短途旅行的个人或小团体游客。
- **用户特征**:
  - 追求效率，希望快速获得行程参考的年轻用户。
  - 对AI新应用感兴趣，愿意尝试使用智能工具的科技爱好者。
  - 对目的地不熟悉，需要规划指导的初次访问者。

---

## 3. 核心功能与用户故事

### 3.1. 功能列表
- **F1**: 用户输入旅行基本信息（城市、天数、兴趣、**旅行风格**、**必游景点**）。
- **F2**: AI智能生成行程。
- **F3**: 结构化展示每日行程计划。
- **F4**: 加载与错误状态处理。
- **F5 (新增)**: 用户可对单个不喜欢的活动进行“替换”操作。

### 3.2. 用户故事
- **作为一名用户**: 我希望能输入我想去的城市、旅行几天以及我的偏好（如美食、历史），**并且可以指定几个我必须去的地方**，以便AI能围绕我的核心需求规划行程。
- **作为一名用户**: 我希望可以选择一个**旅行节奏**（比如“轻松点”或“紧凑点”），来决定一天安排多少活动。
- **作为一名用户**: 我希望看到的行程不仅有活动安排，**还能告诉我从上一个地方到下一个地方大概要多久**，这样我心里有数。
- **作为一名用户**: 如果我对某个推荐的活动不满意，我希望能**点击一个按钮快速换一个**，而不是从头再来。

---

## 4. 功能规格 (Functional Specifications)

### 4.1. 前端 (React)

#### 4.1.1. 主页 (`HomePage.jsx`)
- **输入表单**:
  - 目的地城市: 文本输入框，必填。
  - 旅行天数: 下拉选择框，范围为1至7天，默认值为3。
  - 旅行兴趣: 多选按钮组，用户可选择一个或多个预设兴趣。至少选择一项。
  - **(新增) 旅行风格**: 下拉选择框，选项为“悠闲”、“普通”、“紧凑”，默认值为“普通”。
  - **(新增) 必游景点**: 文本输入框（可选），允许用户输入1-3个希望必须包含在行程中的地点名称，用逗号分隔。

#### 4.1.2. 结果页 (`ResultsPage.jsx`)
- **活动卡片 (`PoiCard.jsx`)**:
  - 每张卡片包含：活动时间段、兴趣点名称(POI)、活动描述、活动类型。
  - **(新增)** 在卡片上显示从上一个活动到此活动的大致交通时间（例如“车程约25分钟”）。首个活动不显示。
  - **(新增)** 每张卡片右下角增加一个“换一个” (Swap) 的图标按钮。点击后，该卡片进入加载状态，并向后端请求一个新的活动建议来替换当前活动。

#### 4.1.3. 状态处理 (`App.jsx`)
- **(新增) 单卡片加载**: 在替换单个活动时，仅在该`PoiCard`上显示加载状态，而不是全屏加载。

### 4.2. 后端 (FastAPI)

#### 4.2.1. API 端点 (`main.py`)
- **`POST /api/plan`**:
  - **请求体 (`schemas.py: PlanRequest`)**:
    '''json
    {
      "city": "string",
      "days": "integer (1-7)",
      "interests": ["string", ...],
      "travel_style": "string (悠闲, 普通, 紧凑)", 
      "must_visit_pois": ["string", ...] 
    }
    '''
  - **成功响应 (`schemas.py: ItineraryResponse`)**: `Activity`模型中增加新字段。

- **(新增) `POST /api/regenerate-activity`**:
  - **用途**: 用于替换单个不满意的活动。
  - **请求体 (`schemas.py: RegenerateRequest`)**:
    '''json
    {
      "city": "string",
      "day_plan": { ... }, 
      "activity_to_replace": { ... }, 
      "interests": ["string", ...],
      "travel_style": "string"
    }
    '''
  - **成功响应 (`schemas.py: Activity`)**: 返回一个新的`Activity`对象。

#### 4.2.2. AI服务逻辑 (`services.py`)
- **提示词工程 (`prompt_template.py`)**:
  - **(增强)** `PROMPT_TEMPLATE` 需要更新，以处理新增的`travel_style`和`must_visit_pois`输入。
  - **(增强)** 强制要求LLM为每个`<activity>`额外输出三个子元素：`<lat>` (纬度), `<lon>` (经度), 和 `<travel_from_previous>` (从上个活动到此处的交通时间描述)。
- **XML解析 (`parse_xml_to_json`)**:
  - **(更新)** 解析逻辑需要更新，以提取新增的`lat`, `lon`, 和 `travel_from_previous`字段并填充到`Activity`模型中。

#### 4.2.3. 数据模型 (`schemas.py`)
- **`Activity` 模型**:
  '''python
  class Activity(BaseModel):
      time: str
      poi_name: str
      description: str
      type: str
      lat: float  # 新增
      lon: float  # 新增
      travel_from_previous: str # 新增, e.g., "步行约15分钟"
  '''

---

## 5. 用户流程 (User Flow)

1.  **进入应用**: 用户看到主页表单。
2.  **填写信息**: 用户输入“北京”，选择“3天”，点击“历史古迹”，选择“普通”旅行风格，并在“必游景点”中输入“故宫, 长城”。
3.  **开始生成**: 用户点击“立即生成行程”。
4.  **等待响应**: 页面切换到全屏加载状态。
5.  **查看结果**: 页面显示“您的北京3日专属行程”。
6.  **不满意并替换**: 用户看到第二天的某个活动“798艺术区”不感兴趣，点击该活动卡片上的“换一个”按钮。
7.  **单个活动加载**: “798艺术区”卡片自身显示加载动画。几秒后，它被更新为“国家博物馆”，并显示了从上一个地点到这里的交通时间。
8.  **重新规划**: 用户在结果页点击“返回重新规划”，返回主页。

---

## 6. 非功能性需求

- **性能**: 页面加载速度快。API响应时间在可接受范围内。
- **用户体验 (UX)**: 界面简洁、直观。操作流程无歧义。加载和错误状态有清晰的反馈。
- **响应式设计**: 应用在桌面和移动设备上都应有良好的显示和使用体验。
- **可扩展性**: 核心模块（兴趣列表、提示词、LLM模型）应易于扩展和迭代。

---

## 7. 未来规划 (Roadmap)

- **V1.1 (当前)**:
  - **(已完成)** 集成真实LLM。
  - **(当前任务)** 实现增强的输入、输出和活动替换功能。
- **V1.2 (中期)**:
  - **地图视图**: **(更容易实现)** 利用已有的经纬度数据，在页面上展示当天所有兴趣点的地理位置分布图。
  - **用户反馈**: 允许用户对生成的行程进行评分（“顶”或“踩”）。
- **V2.0 (长期)**:
  - **行程编辑**: 允许用户拖拽排序、删除、手动添加活动。
  - **用户账户**: 支持用户注册登录，保存和管理历史行程。
  - **分享功能**: 允许用户将生成的行程分享给朋友。