# 产品需求文档 (PRD): 行程AIGC (Travel_LLM)

**版本**: 1.0
**日期**: 2025年6月30日
**负责人**: Gemini

---

## 1. 产品简介与目标

### 1.1. 产品简介
行程AIGC (Travel_LLM) 是一个基于大型语言模型（LLM）的智能旅行规划应用。它允许用户通过输入目的地城市、旅行天数和个人兴趣，快速生成一份结构清晰、内容丰富的个性化旅行日程。

### 1.2. 产品目标
- **核心问题**: 传统旅行规划耗时耗力，信息搜集繁琐，且难以快速个性化。
- **产品价值**: 旨在通过AI技术极大简化行程规划流程，让用户在几秒钟内获得一份高质量、个性化的旅行计划，从而提升旅行规划的效率和乐趣。
- **初期目标**: 验证核心功能，打通前后端及AI服务，为用户提供流畅的基础行程生成体验。

---

## 2. 目标用户

- **主要用户**: 计划进行1-7天短途旅行的个人或小团体游客。
- **用户特征**:
  - 追求效率，希望快速获得行程参考的年轻用户。
  - 对AI新应用感兴趣，愿意尝试使用智能工具的科技爱好者。
  - 对目的地不熟悉，需要规划指导的初次访问者。

---

## 3. 核心功能与用户故事

### 3.1. 功能列表
- **F1**: 用户输入旅行基本信息（城市、天数、兴趣）。
- **F2**: AI智能生成行程。
- **F3**: 结构化展示每日行程计划。
- **F4**: 加载与错误状态处理。

### 3.2. 用户故事
- **作为一名用户**: 我希望能输入我想去的城市、旅行几天以及我的偏好（如美食、历史），以便快速得到一份为我量身定制的旅行计划。
- **作为一名用户**: 我希望看到的行程是按天组织的，每天的活动安排清晰明了，包含时间、地点、简介和活动类型。
- **作为一名用户**: 在等待AI生成行程时，我希望能看到一个加载提示，而不是一个空白页面。
- **作为一名用户**: 如果行程生成失败或我的输入有误，我希望能得到明确的错误提示，并可以方便地返回首页重试。

---

## 4. 功能规格 (Functional Specifications)

### 4.1. 前端 (React)

#### 4.1.1. 主页 (`HomePage.jsx`)
- **输入表单**:
  - **目的地城市**: 文本输入框，必填。
  - **旅行天数**: 下拉选择框，范围为1至7天，默认值为3。
  - **旅行兴趣**: 多选按钮组，用户可选择一个或多个预设兴趣。至少选择一项。
- **交互**:
  - 点击“立即生成行程”按钮提交表单。
  - 提交前进行客户端验证，确保城市已填写且至少选择一个兴趣。

#### 4.1.2. 结果页 (`ResultsPage.jsx`)
- **整体展示**:
  - 显示总标题，如“您的 [城市] [天数]日专属行程”。
  - 提供一个“返回重新规划”的按钮，点击后清空当前数据并返回主页。
- **按天切换**:
  - 若行程超过1天，则显示天数切换标签（例如“第1天”、“第2天”）。
  - 用户点击标签可切换查看对应日期的行程安排。默认显示第一天。
- **活动卡片 (`PoiCard.jsx`)**:
  - 每日的活动以卡片列表形式展示。
  - 每张卡片包含：活动时间段、兴趣点名称(POI)、活动描述、活动类型。
  - 活动类型（如景点, 美食, 购物）应有不同的颜色和图标进行视觉区分，增强可读性。

#### 4.1.3. 状态处理 (`App.jsx`)
- **加载状态**: 调用API期间，全屏显示加载动画 (`LoadingSpinner.jsx`) 和提示文字。
- **错误状态**: 若API返回错误或请求失败，全屏显示错误信息和“返回首页重试”的按钮。

### 4.2. 后端 (FastAPI)

#### 4.2.1. API 端点 (`main.py`)
- **路径**: `POST /api/plan`
- **请求体 (`schemas.py: PlanRequest`)**:
  ```json
  {
    "city": "string",
    "days": "integer (1-7)",
    "interests": ["string", ...]
  }
  ```
- **成功响应 (`schemas.py: ItineraryResponse`)**: 返回包含城市、总天数和每日行程的JSON结构。
- **错误响应**: 若发生内部错误（如LLM响应解析失败），返回 `500` 状态码和详细错误信息的JSON。

#### 4.2.2. AI服务逻辑 (`services.py`)
- **提示词工程 (`prompt_template.py`)**:
  - 使用一个结构化、要求严格的提示词模板 (`PROMPT_TEMPLATE`)。
  - 该模板强制要求LLM以特定的XML格式输出结果，明确定义了根元素、子元素及其属性和顺序。
- **LLM调用**:
  - **(当前)**: 使用一个模拟函数 `generate_plan_from_llm`，它不进行真实API调用，而是返回一个硬编码的XML (`SIMULATED_LLM_XML_OUTPUT`)。该模拟会根据用户请求动态修改XML中的城市和天数，以提供更真实的开发体验。
  - **(未来)**: 此处应替换为对OpenAI或其他LLM提供商的真实API调用。
- **XML解析**:
  - `parse_xml_to_json` 函数负责将LLM返回的XML字符串转换为标准化的JSON对象。
  - **健壮性**: 能够处理LLM返回的不规范内容，例如清理XML代码块前后的markdown标记(` ```xml`)或多余的解释性文本。
  - **错误处理**: 如果XML格式严重错误导致解析失败，必须捕获异常并向上层抛出，以便API可以向客户端返回有意义的错误信息。

---

## 5. 用户流程 (User Flow)

1.  **进入应用**: 用户打开网页，看到主页的输入表单。
2.  **填写信息**: 用户输入“成都”，选择“3天”，并点击“美食探索”和“历史古迹”兴趣标签。
3.  **开始生成**: 用户点击“立即生成行程”按钮。
4.  **等待响应**: 页面切换到加载状态，显示“正在为您生成专属行程...”。
5.  **查看结果**:
    - **成功**: 页面显示“您的成都3日专属行程”。默认展示第1天的活动列表，用户可以点击“第2天”、“第3天”切换查看。
    - **失败**: 页面显示错误信息，例如“无法连接到服务器...”，并提供返回按钮。
6.  **重新规划**: 用户在结果页点击“返回重新规划”，页面返回到主页，所有输入框被清空，可以开始一次新的规划。

---

## 6. 非功能性需求

- **性能**: 页面加载速度快。API响应时间在可接受范围内（真实LLM调用可能需要5-10秒，加载动画是必要的）。
- **用户体验 (UX)**: 界面简洁、直观。操作流程无歧义。加载和错误状态有清晰的反馈。
- **响应式设计**: 应用在桌面和移动设备上都应有良好的显示和使用体验。
- **可扩展性**:
  - **兴趣列表**: `ALL_INTERESTS` 应易于在前端代码中修改和扩展。
  - **提示词**: `PROMPT_TEMPLATE` 作为核心资产，应易于迭代和优化，以提升生成质量。
  - **LLM模型**: 更换或升级LLM模型应只需修改`services.py`中的调用逻辑。

---

## 7. 未来规划 (Roadmap)

- **V1.1 (短期)**:
  - **集成真实LLM**: 替换当前的模拟API调用为真实的OpenAI GPT-4或同级别模型调用。
  - **环境变量配置**: 将API密钥等敏感信息通过环境变量注入，而不是硬编码。
- **V1.2 (中期)**:
  - **用户反馈**: 允许用户对生成的行程进行评分（“顶”或“踩”），用于未来模型微调。
  - **地图视图**: 集成地图服务，在页面上展示当天所有兴趣点的地理位置分布。
- **V2.0 (长期)**:
  - **行程编辑**: 允许用户在生成的行程基础上进行修改，如删除某个活动、替换为备选活动等。
  - **用户账户**: 支持用户注册登录，保存和管理历史行程。
  - **分享功能**: 允许用户将生成的行程分享给朋友。
