# 产品需求文档 (PRD): 行程AIGC (Travel_LLM)

**版本**: 1.2
**日期**: 2025年7月1日
**负责人**: Gemini

---

## 0. 修订历史

- **v1.2 (2025/07/01)**: **产品升维**。深度整合美食规划，引入预算控制、开放时间与预订链接等“可执行”信息，增加行程保存与分享功能。
- **v1.1 (2025/07/01)**: 增强输入（必游景点、旅行风格），提升输出质量（地理坐标、交通时间），并增加活动替换功能。
- **v1.0 (2025/06/30)**: 初始版本，定义核心生成流程。

---

## 1. 产品简介与愿景

### 1.1. 产品简介

行程AIGC (Travel_LLM) 是一个基于大型语言模型（LLM）的智能旅行规划应用。它允许用户通过输入目的地城市、旅行天数和个人兴趣，快速生成一份结构清晰、内容丰富的个性化旅行日程。

### 1.2. 产品愿景

我们的愿景是将 Travel_LLM 打造成一个**动态、贴心、可执行的私人旅行管家**。它不仅能生成行程，更能理解用户的深层需求（如预算、口味），预见并解决用户在旅行中可能遇到的实际问题（如开放时间、预订），创造顺畅、愉悦、无忧的旅行规划体验。

---

## 2. 目标用户

*(本节无变化)*

---

## 3. 核心功能与用户故事

### 3.1. 功能列表

- **F1**: 用户输入全面的旅行偏好（城市、天数、兴趣、旅行风格、必游景点、**预算**、**餐饮偏好**）。
- **F2**: AI智能生成包含**活动**与**美食**的混合行程。
- **F3**: 结构化展示每日行程计划，并附带**开放时间、预订链接、当地人贴士**等丰富信息。
- **F4**: 加载与错误状态处理。
- **F5**: 用户可对单个活动进行“替换”操作。
- **F6 (新增)**: 用户可以**保存**生成的行程，并在需要时**分享**给他人。

### 3.2. 用户故事

- **作为一名美食爱好者**: 我希望AI不仅能推荐餐厅，还能根据我的**预算和口味**，将合适的餐厅**穿插**在我的日程中，而不是让我自己去查。
- **作为一名注重效率的规划者**: 我希望生成的行程直接告诉我景点的**开放时间**和餐厅的**预订电话/链接**，我不想再花时间去一个个搜索确认。
- **作为一名普通用户**: 我希望AI能给我一些**当地人才知道的小建议**，让我的旅行更有趣。
- **作为一名用户**: 我精心调整好的行程，希望能**保存下来**，方便我之后随时查看，或者**发给我的朋友**一起讨论。

---

## 4. 功能规格 (Functional Specifications)

### 4.1. 前端 (React)

#### 4.1.1. 主页 (`HomePage.jsx`)

- **输入表单**:
  - **(新增) 总体预算**: 下拉选择框，选项为“经济”、“标准”、“优质”，默认值为“标准”。
  - **(新增) 餐饮偏好**:
    - **人均消费**: 选择框（如 ¥50-100, ¥100-200, ¥200+）。
    - **菜系/口味**: 多选标签（如 本地特色, 川菜, 西餐, 咖啡厅, 酒吧）。
    - **忌口/特殊要求**: 文本输入框（可选，如 素食, 不吃辣）。
  - 其他输入项保持不变。

#### 4.1.2. 结果页 (`ResultsPage.jsx`)

- **(新增) 顶部操作栏**:
  - “返回重新规划”按钮。
  - **“保存行程”** 按钮。
  - **“分享”** 按钮（点击后可生成一个唯一链接或复制行程文本）。
- **活动/美食卡片 (`PoiCard.jsx`)**:
  - **卡片类型区分**: 采用不同图标或颜色区分“景点活动”与“餐饮美食”。
  - **新增信息字段**:
    - **开放时间**: (例如 “周二至周日 09:00-17:00”)。
    - **预订信息**: (例如 “电话: 123-4567” 或 “在线预订”链接)。
    - **当地人贴士**: (例如 “建议提前一周预订靠窗位置”)。
    - **价格/消费**: (对于餐厅，显示“人均 ¥150”；对于景点，显示门票价格)。
  - “换一个”按钮保持不变。

### 4.2. 后端 (FastAPI)

#### 4.2.1. API 端点 (`main.py`)

- **`POST /api/plan`**:
  - **请求体 (`schemas.py: PlanRequest`)**:
    ```json
    {
      "city": "string",
      "days": "integer",
      "interests": ["string", ...],
      "travel_style": "string",
      "must_visit_pois": ["string", ...],
      "budget": "string (经济, 标准, 优质)",
      "food_preferences": {
        "price_range": "string",
        "cuisine_types": ["string", ...],
        "dietary_restrictions": "string"
      }
    }
    ```
- **(新增) `POST /api/save-itinerary`**:
  - **请求体**: 包含完整的行程JSON数据。
  - **响应**: 返回一个唯一的ID或URL用于后续访问。
- 其他API端点保持不变。

#### 4.2.2. AI服务逻辑 (`services.py`)

- **提示词工程 (`prompt_template.py`)**:
  - **(重大升级)** `PROMPT_TEMPLATE` 需重构，指令AI扮演一个经验丰富的“本地旅行管家”。
  - 明确要求AI根据用户的**预算**和**餐饮偏好**，在每日行程的**午餐和晚餐**时间点，智能插入地理位置合理的美食推荐。
  - 强制要求LLM为每个 `<activity>`和新增的 `<food_stop>`元素，输出更丰富的子元素：`<opening_hours>`, `<booking_info>`, `<local_tip>`, `<price>`。

#### 4.2.3. 数据模型 (`schemas.py`)

- **`Activity` / `FoodStop` 模型 (可合并为一个通用模型)**:
  ```python
  class ItineraryItem(BaseModel):
      category: str # '景点', '美食', '购物', '体验'
      time: str
      poi_name: str
      description: str
      lat: float
      lon: float
      travel_from_previous: str
      opening_hours: str # 新增
      booking_info: str  # 新增
      price: str         # 新增 (e.g., "门票: ¥120" or "人均: ¥150")
      local_tip: str     # 新增
  ```

---

## 5. 用户流程 (User Flow)

*(流程更新以反映新功能)*

1. **填写信息**: 用户输入“杭州”，选择“2天”，兴趣“丝绸文化”，预算“标准”，并指定希望去“西湖”，餐饮偏好为“本地特色、人均¥150以内”。
2. **查看结果**: AI生成了包含景酒和餐厅的详细行程。用户看到第一天下午的活动是“中国丝绸博物馆”，之后推荐了附近的餐厅“知味观”，卡片上写着“人均¥80，推荐菜: 东坡肉、知味小笼。贴士: 饭点人多，建议提前取号”。
3. **保存与分享**: 用户对行程很满意，点击“保存行程”，系统提示“保存成功！”。随后用户点击“分享”，复制了一个链接发给朋友。

---

## 6. 未来规划 (Roadmap)

- **V1.2 (当前任务)**:
  - 实现深度美食规划、预算控制及“可执行信息”增强。
  - 实现行程的保存与分享。
- **V2.0 (中期): 交互性与动态适应 (Interactivity & Dynamic Adaptation)**
  - **全功能行程编辑 (Full Itinerary Editing):**
    - **拖拽调整**: 用户可在日程中随意拖拽活动，调整顺序或移动到不同日期。
    - **增删改查**: 支持手动删除、修改活动时间，或通过搜索添加新的兴趣点。
    - **智能重算**: 每次编辑后，AI自动重新计算并更新活动间的交通时间。
  - **交互式地图视图 (Interactive Map View):**
    - 将每日行程的所有点（景点、餐厅）在地图上进行可视化展示。
    - 用户可以通过地图直观感受路线的合理性，并点击地图上的点查看详情。
  - **天气应变计划 (Weather Contingency Plan):**
    - 接入实时天气预报API。
    - 当预报有雨雪等恶劣天气时，主动为受影响的户外活动提供室内备选方案（如博物馆、购物中心、特色咖啡馆）。
- **V2.1 (长期): 一站式旅行服务 (All-in-One Travel Service)**
  - **智能住宿推荐 (Smart Accommodation Suggestions):**
    - 根据用户预算、旅行风格以及行程的地理重心，智能推荐合适的酒店或民宿。
    - 在地图上展示推荐住宿的位置及其与行程活动点的距离。
  - **精细化交通规划 (Detailed Transportation Planning):**
    - 提供从一个活动点到下一个的具体公共交通路线（地铁、公交）、步行导航或网约车预估时间和费用。
  - **预算追踪与管理 (Budget Tracking & Management):**
    - 根据行程中包含的门票、餐饮和交通预估费用，实时计算总预算，并与用户设定的标准进行对比。
  - **离线模式与PWA (Offline Mode & PWA):**
    - 支持将最终行程缓存到本地，实现无网络访问。
    - 提供“添加到主屏幕”功能，方便用户快速启动。
  - **多语言支持 (Multi-language Support):**
    - 支持多语言界面和多语言行程输出。
